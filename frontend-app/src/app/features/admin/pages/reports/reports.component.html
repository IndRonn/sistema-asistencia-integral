<div class="p-6 min-h-screen text-sys-silver animate-fade-in max-w-7xl mx-auto">

  <div class="mb-8 border-b border-sys-dim pb-6">
    <h1 class="text-3xl font-serif text-white">Reportes de Inteligencia</h1>
    <p class="text-xs text-gray-500 uppercase tracking-[0.2em] mt-1">
      An√°lisis Hist√≥rico & Exportaci√≥n de Evidencia
    </p>
  </div>

  <div class="bg-sys-surface border border-sys-dim p-4 mb-6 flex flex-col lg:flex-row gap-4 items-end shadow-lg rounded-sm">

    <div class="flex gap-2 items-center w-full lg:w-auto">
      <div class="group flex-1">
        <label class="block text-[10px] uppercase text-gray-500 mb-1 font-bold">Desde</label>
        <input type="date" [(ngModel)]="fechaInicio"
               class="w-full bg-sys-black border border-sys-dim text-white py-2 px-3 text-sm focus:outline-none focus:border-sys-primary transition-colors [&::-webkit-calendar-picker-indicator]:invert cursor-pointer">
      </div>
      <div class="group flex-1">
        <label class="block text-[10px] uppercase text-gray-500 mb-1 font-bold">Hasta</label>
        <input type="date" [(ngModel)]="fechaFin"
               class="w-full bg-sys-black border border-sys-dim text-white py-2 px-3 text-sm focus:outline-none focus:border-sys-primary transition-colors [&::-webkit-calendar-picker-indicator]:invert cursor-pointer">
      </div>
    </div>

    <div class="group flex-1 w-full lg:w-auto min-w-[200px]">
      <label class="block text-[10px] uppercase text-gray-500 mb-1 font-bold">Agente Objetivo</label>
      <select [(ngModel)]="selectedEmpleado"
              class="w-full bg-sys-black border border-sys-dim text-white py-2 px-3 text-sm focus:outline-none focus:border-sys-primary appearance-none cursor-pointer">
        <option value="">-- TODOS LOS AGENTES --</option>
        <option *ngFor="let emp of empleados()" [value]="emp.idUsuario">
          {{ emp.nombres }} {{ emp.apellidos }} (@{{ emp.username }})
        </option>
      </select>
    </div>

    <div class="flex gap-2 w-full lg:w-auto">

      <button (click)="generarReporte()"
              [disabled]="isLoading()"
              class="flex-1 lg:flex-none bg-sys-primary hover:bg-green-800 text-white px-6 py-2 text-sm uppercase font-bold transition-all disabled:opacity-50 flex items-center justify-center gap-2 h-[38px] min-w-[120px]">
        <span *ngIf="isLoading()" class="animate-spin text-lg">‚Üª</span>
        <span *ngIf="!isLoading()">Generar</span>
      </button>

      <button (click)="exportar('EXCEL')"
              [disabled]="isExporting()"
              class="flex-1 lg:flex-none border border-sys-dim text-sys-silver hover:bg-white/5 hover:text-white px-4 py-2 text-sm uppercase font-bold transition-all h-[38px] flex items-center justify-center gap-2 disabled:opacity-50 min-w-[120px]">
        <span *ngIf="isExporting()" class="animate-pulse">‚è≥</span>
        <span *ngIf="!isExporting()">üìä Excel</span>
      </button>

      <button (click)="exportar('PDF')"
              [disabled]="isExporting()"
              class="flex-1 lg:flex-none border border-sys-alert text-sys-alert hover:bg-sys-alert hover:text-white px-4 py-2 text-sm uppercase font-bold transition-all h-[38px] flex items-center justify-center gap-2 disabled:opacity-50 min-w-[100px]">
        <span *ngIf="isExporting()" class="animate-pulse">‚è≥</span>
        <span *ngIf="!isExporting()">üìÑ PDF</span>
      </button>

    </div>
  </div>

  <div class="overflow-hidden border border-sys-dim bg-sys-surface shadow-2xl relative min-h-[400px] rounded-sm">

    <table class="w-full text-left text-sm">
      <thead class="bg-black/50 text-xs uppercase font-bold tracking-wider text-gray-500 border-b border-sys-dim">
      <tr>
        <th class="px-6 py-4">Agente</th>
        <th class="px-6 py-4">Fecha</th>
        <th class="px-6 py-4">Entrada / Salida</th>
        <th class="px-6 py-4">Estado</th>
        <th class="px-6 py-4">Observaciones</th>
      </tr>
      </thead>

      <tbody class="divide-y divide-sys-dim/20 transition-opacity duration-300"
             [class.opacity-40]="isLoading()"
             [class.pointer-events-none]="isLoading()">

      <tr *ngIf="!isLoading() && reportes().length === 0">
        <td colspan="5" class="px-6 py-20 text-center text-gray-500">
          <div class="flex flex-col items-center gap-3">
            <span class="text-4xl opacity-20">üìä</span>
            <span class="text-sm">No hay datos de inteligencia para los filtros seleccionados.</span>
          </div>
        </td>
      </tr>

      <tr *ngFor="let row of reportes()" class="group hover:bg-white/5 transition-colors">

        <td class="px-6 py-4">
          <div class="font-bold text-white">{{ row.nombreCompleto }}</div>
          <div class="text-xs text-sys-dim flex items-center gap-1">
            <span class="text-sys-primary">‚óè</span> @{{ row.username }}
          </div>
        </td>

        <td class="px-6 py-4 font-mono text-gray-300">
          {{ row.fecha }}
        </td>

        <td class="px-6 py-4 text-gray-400 font-mono text-xs">
          <div class="flex items-center gap-2">
            <span class="w-8 text-right text-gray-500">IN:</span>
            <span class="text-white">{{ row.horaEntrada || '--:--:--' }}</span>
          </div>
          <div class="flex items-center gap-2 mt-1">
            <span class="w-8 text-right text-gray-500">OUT:</span>
            <span class="text-white">{{ row.horaSalida || '--:--:--' }}</span>
          </div>
        </td>

        <td class="px-6 py-4">
          <app-ui-badge [variant]="getVariant(row.estado)">
            {{ row.estadoDescripcion }}
          </app-ui-badge>
        </td>

        <td class="px-6 py-4">
          <div *ngIf="row.justificacion" class="group/tooltip relative flex items-center gap-2 cursor-help">
            <span class="text-lg">üìù</span>
            <span class="text-xs italic text-gray-400 truncate max-w-[150px]">
                {{ row.justificacion }}
              </span>

            <div class="absolute bottom-full left-0 mb-2 hidden group-hover/tooltip:block bg-black border border-sys-dim p-2 rounded shadow-xl text-xs text-white whitespace-nowrap z-50">
              {{ row.justificacion }}
            </div>
          </div>
          <span *ngIf="!row.justificacion" class="text-sys-dim opacity-20 text-xs tracking-widest uppercase">N/A</span>
        </td>

      </tr>
      </tbody>
    </table>
  </div>
</div>
